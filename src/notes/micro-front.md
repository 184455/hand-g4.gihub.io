---
title: 如何实现微前端
order: 1
toc: menu
nav:
  title: Notes
  order: 3
---

## 什么是微前端?

微前端就是一种将多个可独立交付的小型前端应用聚合为一个整体的架构风格。

## 微前端的优势有哪些？

- 同步更新。只需更新服务应用，主应用就会同步更新。
- 增量升级。保留原有项目的同时可以使用新技术实现新需求。
- 独立部署与发布。不同的服务应用可以单独构建单独发布，减少构建成本。
- 独立团队决策。服务应用可独立选择技术栈。

## 微前端实现方式

1. 加载微应用

   - 从 html 文件加载。
     - 加载 link: 样式文件单独请求单独处理（防止样式泄露）、其他文件直接修改 src
     - 加载图片: 直接修改 src
     - 加载 script: 远程文件先请求再执行，嵌入脚本直接执行
   - 从 js 文件加载。通过 System.js 直接获取入口方法。

2. 拦截路由

   - 重写 pushState 和 replaceState 方法，以在 history 变化时触发事件。
   - 重写`window.addEventListener`和`window.removeEventListener`，以将 hashchange 和 popstate 视为同一事件。

3. 挂载微应用

   - 创建微应用的挂载容器。将入口获取的 html 文本放入容器内。
   - 在微应用首次启动时调用微应用的启动方法。
   - 在微应用激活时调用微应用挂载方法，并将容器传入该方法。
   - 将容器挂载到父应用 dom 上。

4. 卸载微应用

   - 在微应用失活时调用微应用卸载方法，并将容器传入该方法。
   - 将容器从父应用 dom 上移除。

5. 沙箱

   - js 沙箱。
     - 代理模式：为 window 对象创建代理，所有修改均在代理对象上进行。
     - 快照模式：在启动沙箱时保存 window 对象上的属性，沙箱运行期间所有修改直接在 window 对象上进行，在沙箱停止时从快照上恢复 window 对象。
   - css 沙箱。
     - 严格模式：在创建容器时为容器创建 shadow dom，并将 shadow dom 作为新的容器使用。拦截 head 的 appendChild 方法，在微应用往 head 中插入 style 元素时仅将元素插入到 shadow dom 中。
     - 非严格模式：监听全局 dom 结构变化，在往 dom 中插入 style 元素时，拦截要插入的元素，并为每条样式规则添加仅容器内的限定规则。

6. 状态管理

   - 在父应用中创建数据中心，并将注册依赖、修改状态的方法传入微应用的声明周期函数中。

## 微前端的实现方式有哪些？

- single-spa
- qiankun
- iframe
- WebComponent
- EMP
